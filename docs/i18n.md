# Internationalisation (i18n) EchoMaps

## Stack

- **next-intl** (v4) avec App Router et segment dynamique `[locale]`.
- **URL** : `/[locale]/...` (ex. `/fr/dashboard`, `/en/dashboard`). Locale par défaut : `fr`.
- **Proxy** : `app/frontend/proxy.ts` (Next.js 16 / next-intl) pour la détection de locale et les redirections.

## Fichiers de messages

- **Emplacement** : `app/frontend/messages/`
- **Fichiers** : `fr.json`, `en.json`
- **Structure** : clés groupées par namespace (`common`, `metadata`, `home`, `nav`, `errors`, `brainDump`, `revise`, `dashboard`, `timeline`, `actions`, `loading`, `recentProjects`, `features`, `doc`).

## Ajouter une langue

1. Créer `app/frontend/messages/<code>.json` en copiant `en.json` ou `fr.json` et en traduisant les valeurs.
2. Ajouter le code dans `app/frontend/i18n/routing.ts` :
   ```ts
   export const routing = defineRouting({
     locales: ["en", "fr", "de"], // ajouter "de"
     defaultLocale: "fr",
     localePrefix: "always",
   });
   ```
3. Ajouter `{ locale: "<code>" }` dans `generateStaticParams()` si besoin (déjà dérivé de `routing.locales` dans le layout).

## Ajouter une clé de traduction

1. Ajouter la clé dans **tous** les fichiers sous `messages/` (ex. `messages/fr.json` et `messages/en.json`).
2. Utiliser la clé dans un composant :
   - **Client** : `const t = useTranslations('namespace');` puis `t('key')`.
   - **Server** : `const t = await getTranslations('namespace');` puis `t('key')`.
3. Pour les paramètres : `t('key', { param: value })` (ex. `errors.systemInterrupt` avec `{ code }`).

## Liens et navigation

- Utiliser `Link` et `useRouter` / `usePathname` depuis `@/i18n/navigation` (et non `next/link` / `next/navigation`) pour que les URLs soient préfixées par la locale.

## Erreurs API

- Le backend renvoie des messages en anglais. Le frontend mappe les chaînes connues vers des clés i18n dans `app/frontend/lib/errorMessages.ts` (`getErrorKey` / `getErrorMessageKey`). Pour afficher une erreur : récupérer la clé avec `getErrorMessageKey(apiError)` ; si non nulle, utiliser `t(\`errors.${key}\`)`, sinon afficher le message brut.

## Métadonnées et SEO

- Les métadonnées (title, description, openGraph) sont définies par `generateMetadata` dans `app/[locale]/layout.tsx` à partir des clés `metadata.*`.
- `<html lang={locale}>` est défini dans le layout racine via le header `x-next-intl-locale` (proxy next-intl).
